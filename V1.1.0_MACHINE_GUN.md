# ?? MegaCrossbows v1.1.0 - MACHINE GUN MODE! ??

## ? **MAJOR CHANGES - THIS SHOULD ACTUALLY WORK NOW!**

### What Was Fixed:

#### **1. Rapid Fire - COMPLETELY REWRITTEN! ??**
- **Before**: Used `StartAttack()` which only fires once, then Valheim blocks until reload
- **After**: **DIRECTLY SPAWNS PROJECTILES** bypassing Valheim's attack system entirely
- **Result**: TRUE MACHINE GUN FIRE! Every shot spawns a new bolt!

#### **2. Zoom - Fixed Scroll Conflict! ??**
- **Before**: Fought with vanilla zoom, scroll didn't work
- **After**: Inverted scroll direction (+ instead of -) and increased sensitivity
- **Result**: Smooth sniper-scope style zoom with working scroll!

#### **3. Visual & Audio Feedback! ??**
- Attack animation plays for each shot (via reflection)
- Camera shake on every shot
- Ammo counter shows every 100 rounds or when < 10
- Stamina drains slightly per shot

---

## ?? **How It Works Now**

### Machine Gun Fire System:
```
Every 0.2 seconds (5 shots/sec default):
  1. Check if mouse button held
  2. Check magazine not empty
  3. Check not reloading
  4. SPAWN PROJECTILE DIRECTLY ? This is the key!
  5. Play animation
  6. Add camera shake
  7. Decrease magazine count
```

**No more waiting for Valheim's reload animation!**

---

## ?? **Testing Instructions**

### 1. **MUST RESTART VALHEIM!**
```
Close Valheim completely (don't just quit to menu)
Reopen via r2modman ? "Start Modded"
```

### 2. **Spawn Ripper**
```
Press F5 for console
Type: spawn Ripper 1
Equip it
```

### 3. **Test Rapid Fire**
```
HOLD Left Mouse Button
? Should see MULTIPLE PROJECTILES flying!
? Camera shakes with each shot
? Ammo counter shows in top-left every 100 rounds
? After 1000 rounds: "Reloading..." ? 2 sec ? "Reloaded!"
```

### 4. **Test Zoom**
```
HOLD Right Mouse ? Zoom in
Scroll UP ? Zoom in more (closer)
Scroll DOWN ? Zoom out (wider view)
Release Right Mouse ? Return to normal
```

---

## ?? **What You Should See**

### Rapid Fire Test:
1. Aim at a wall/ground
2. Hold left mouse for 5 seconds
3. **You should see ~25 bolts** (5 shots/sec × 5 seconds)
4. Each bolt should stick into the surface
5. Camera should shake slightly with each shot

### Zoom Test:
1. Hold right mouse
2. FOV should narrow (zoom in)
3. Scroll wheel should zoom further in/out
4. Smooth adjustment without stuttering

---

## ?? **Recommended Config for Testing**

Edit config file:
```
%AppData%\r2modmanPlus-local\Valheim\profiles\Valheim Min Mods\BepInEx\config\com.rikal.megacrossbows.cfg
```

### **Machine Gun Config:**
```ini
[General]
Enabled = true
DamageMultiplier = 100.0
FireRate = 10.0           # 10 shots/second - very visible!

[Zoom]
ZoomMin = 2.0
ZoomMax = 15.0            # 15x zoom for true sniper scope

[Projectile]
Velocity = 200.0          # 2x faster bolts
NoGravity = true          # No drop - laser straight!

[Magazine]
Capacity = 200            # Smaller for testing reload faster
```

### **Gatling Gun Config:**
```ini
[General]
FireRate = 30.0           # 30 shots/second - BRRRRRR!
DamageMultiplier = 50.0   # Lower damage to balance

[Projectile]
Velocity = 300.0          # Super fast
NoGravity = true

[Magazine]
Capacity = 3000           # Won't run out quickly
```

### **Sniper Config:**
```ini
[General]
FireRate = 1.0            # 1 shot/second - deliberate
DamageMultiplier = 500.0  # One-shot kills

[Zoom]
ZoomMin = 5.0
ZoomMax = 20.0            # 20x zoom - long range

[Projectile]
Velocity = 400.0          # Extremely fast
NoGravity = true

[Magazine]
Capacity = 10             # Limited ammo
```

---

## ?? **Technical Details**

### How Machine Gun Works:
```csharp
FireProjectile() method now:
1. Gets attack data from weapon
2. Calculates spawn position (in front of player)
3. Gets aim direction from camera
4. Instantiates projectile GameObject
5. Applies velocity multiplier
6. Applies damage multiplier  
7. Disables gravity if configured
8. Uses reflection to play animation
9. Adds camera shake
```

**Key**: We bypass `StartAttack()` entirely and directly spawn projectiles!

---

## ?? **Troubleshooting**

### No Rapid Fire?
1. **Did you restart Valheim?** (most common issue)
2. Check console (F5): `"MegaCrossbows v1.0.0 loaded!"`
3. Check config: `Enabled = true`
4. Try `FireRate = 20` for super obvious effect
5. Make sure you're HOLDING the mouse button, not clicking

### Zoom Not Working?
1. Make sure you're using RIGHT mouse button (not left)
2. Try scrolling MORE - increased sensitivity to 5x
3. Check another mod isn't locking camera

### Bolts Not Spawning?
1. Check you have ammo in inventory (crossbow bolts)
2. Check weapon actually has projectile defined
3. Try with vanilla Ripper (not modded crossbow)

### Game Crashes?
1. Check BepInEx log at: `%AppData%\r2modmanPlus-local\Valheim\...\BepInEx\LogOutput.log`
2. Possible conflict with other weapon mods
3. Try disabling other mods temporarily

---

## ?? **Expected Performance**

### Fire Rate Examples:
- **5 shots/sec** (default): 300 rounds/minute - M4 carbine speed
- **10 shots/sec**: 600 rounds/minute - Light machine gun
- **20 shots/sec**: 1200 rounds/minute - Minigun speed
- **30 shots/sec**: 1800 rounds/minute - Gatling gun!

### Magazine Examples:
- **10 rounds**: Sniper style - 2 second fight at 5 shots/sec
- **100 rounds**: Assault rifle - 20 seconds
- **1000 rounds** (default): LMG - 200 seconds (3.3 minutes)
- **5000 rounds**: Sustained fire - 16+ minutes

---

## ?? **This Version Should Work!**

The key difference: **We're not asking Valheim's permission anymore!**

Old way:
```
Click ? Ask Valheim ? Valheim checks cooldowns ? Maybe fire ? Reload animation ? Block more shots
```

New way:
```
Click ? Spawn projectile directly ? Fire! ? Spawn another ? Fire! ? Spawn another ? Fire!
```

---

## ?? **Test Now!**

1. Build deployed ?
2. Restart Valheim ? ? **DO THIS!**
3. Spawn Ripper ?
4. HOLD left mouse ?
5. Watch bolts fly! ??

**Report back with results!** ??

---

## ?? **Pro Tips**

- Lower magazine to 50-100 for frequent reload testing
- Set FireRate to 30 for obviously visible rapid fire
- Use NoGravity = true to see if bolts spawn (they'll fly straight)
- Aim at ground to see bolt impacts
- Try in creative mode first (god mode to avoid stamina issues)

---

**Version: 1.1.0**  
**Status: Machine gun mode implemented!**  
**Next: Your testing feedback!**
